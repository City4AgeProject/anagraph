VariationMeasureValue.doAllNuis = WITH subq1 AS (																			   \
										SELECT                                                                                 \
											uir.id AS user_in_role_id,                                                         \
											uir.pilot_code AS pilot_code,                                                      \
											vm.measure_type_id AS measure_type_id,                                             \
											AVG (vm.measure_value) AVG,                                                        \
											COALESCE (                                                                         \
												STDDEV_SAMP (vm.measure_value),                                                \
												0                                                                              \
											) stDev,                                                                           \
											PERCENTILE_CONT (0.25) WITHIN GROUP (                                              \
												ORDER BY                                                                       \
													vm.measure_value DESC                                                      \
											) best25                                                                           \
										FROM                                                                                   \
											variation_measure_value AS vm                                                      \
										INNER JOIN time_interval AS ti                                                         \
										ON ti.id = vm.time_interval_id                                                         \
										INNER JOIN user_in_role AS uir                                                         \
										ON uir.id = vm.user_in_role_id                                                         \
										WHERE                                                                                  \
											ti.interval_start >= (?1)                                                          \
										AND ti.interval_start <= (?2)                                                          \
										GROUP BY                                                                               \
											uir.id,                                                                            \
											vm.measure_type_id                                                                 \
									),                                                                                         \
									 subq2 AS (                                                                                \
										SELECT                                                                                 \
											detection_variable_id,                                                             \
											derived_detection_variable_id,                                                     \
											pilot_code,                                                                        \
											derivation_function_formula                                                        \
										FROM                                                                                   \
											md_pilot_detection_variable                                                        \
									) SELECT                                                                                   \
										user_in_role_id AS uir_id,                                                             \
										subq2.derived_detection_variable_id AS ddv_id,                                         \
										(                                                                                      \
											CASE                                                                               \
											WHEN AVG = 0 THEN                                                                  \
												0                                                                              \
											WHEN subq2.derivation_function_formula LIKE '%avg%' THEN AVG                       \
											WHEN subq2.derivation_function_formula LIKE '%std%' THEN stDev / AVG               \
											WHEN subq2.derivation_function_formula LIKE '%best%' THEN best25 / AVG             \
											WHEN subq2.derivation_function_formula LIKE '%delta%' THEN (best25 - AVG) / AVG    \
											END                                                                                \
										) nui_value                                                                            \
									FROM                                                                                       \
										subq1,                                                                                 \
										subq2                                                                                  \
									WHERE                                                                                      \
										subq1.pilot_code = subq2.pilot_code                                                    \
									AND subq1.measure_type_id = subq2.detection_variable_id                                    \
									AND subq2.derivation_function_formula IS NOT NULL                                          \
									ORDER BY                                                                                   \
										subq1.user_in_role_id,                                                                 \
										subq2.derived_detection_variable_id

NumericIndicatorValue.doAllGess = WITH mainq AS (                                                                              \
										WITH subq1 AS (                                                                        \
											SELECT                                                                             \
												vwdv.user_in_role_id,                                                          \
												vwdv.pilot_code,                                                               \
												vwdv.detection_variable_id,                                                    \
												vwdv.detection_variable_type,                                                  \
												vwdv.derived_detection_variable_id,                                            \
												vwdv.derivation_weight,                                                        \
												vwmn.derived_nui_id                                                            \
											FROM                                                                               \
												vw_detection_variable_derivation_per_user_in_role AS vwdv                      \
											LEFT JOIN vw_mea_nui_derivation_per_pilots AS vwmn                                 \
											ON vwdv.pilot_code = vwmn.pilot_code                                               \
											AND vwdv.detection_variable_id = vwmn.mea_id                                       \
											WHERE                                                                              \
												vwdv.detection_variable_type = 'MEA'                                           \
											AND vwdv.derived_detection_variable_id IN (                                        \
												SELECT                                                                         \
													vwd.detection_variable_id                                                  \
												FROM                                                                           \
													vw_detection_variable_derivation_per_user_in_role AS vwd                   \
												WHERE                                                                          \
													vwd.detection_variable_type = 'GES'                                        \
											)                                                                                  \
										),                                                                                     \
										subq2 AS (                                                                             \
											SELECT                                                                             \
												nui.user_in_role_id,                                                           \
												nui.nui_type_id,                                                               \
												nui.nui_value,                                                                 \
												nui2.nui_value AS nui_zero_value                                               \
											FROM                                                                               \
												numeric_indicator_value AS nui                                                 \
											INNER JOIN time_interval AS ti                                                     \
											ON nui.time_interval_id = ti.id                                                    \
											LEFT JOIN numeric_indicator_value AS nui2                                          \
											ON nui.user_in_role_id = nui2.user_in_role_id                                      \
											AND nui.nui_type_id = nui2.nui_type_id                                             \
											WHERE                                                                              \
												ti.interval_start >= :startOfMonth                                             \
											AND ti.interval_start <= :endOfMonth                                               \
											AND nui2.id = (                                                                    \
												SELECT                                                                         \
													MIN (nui1.id)                                                              \
												FROM                                                                           \
													numeric_indicator_value AS nui1                                            \
												WHERE                                                                          \
													nui1.user_in_role_id = nui2.user_in_role_id                                \
												AND nui1.nui_type_id = nui2.nui_type_id                                        \
											)                                                                                  \
										),                                                                                     \
										subq3 AS (                                                                             \
											SELECT                                                                             \
												derivation_weight,                                                             \
												user_in_role_id,                                                               \
												detection_variable_id                                                          \
											FROM                                                                               \
												vw_detection_variable_derivation_per_user_in_role                              \
										) SELECT                                                                               \
											subq1.user_in_role_id,                                                             \
											subq1.derived_detection_variable_id,                                               \
											subq1.derivation_weight AS w1,                                                     \
											subq3.derivation_weight,                                                           \
											SUM (                                                                              \
												CASE                                                                           \
												WHEN subq2.nui_zero_value = 0 THEN                                             \
													3                                                                          \
												WHEN (                                                                         \
													subq2.nui_value - subq2.nui_zero_value                                     \
												) * sign(subq1.derivation_weight) / subq2.nui_zero_value > 0.25 THEN 5         \
												WHEN (                                                                         \
													subq2.nui_value - subq2.nui_zero_value                                     \
												) * sign(subq1.derivation_weight) / subq2.nui_zero_value > 0.1 THEN 4          \
												WHEN (                                                                         \
													subq2.nui_value - subq2.nui_zero_value                                     \
												) * sign(subq1.derivation_weight) / subq2.nui_zero_value > -0.1 THEN 3         \
												WHEN (                                                                         \
													subq2.nui_value - subq2.nui_zero_value                                     \
												) * sign(subq1.derivation_weight) / subq2.nui_zero_value > -0.25 THEN 2        \
												ELSE 1                                                                         \
												END                                                                            \
											) / COUNT (subq2.nui_value) derived_mea_value                                      \
										FROM                                                                                   \
											subq1                                                                              \
										INNER JOIN subq2                                                                       \
										ON subq2.nui_type_id = subq1.derived_nui_id                                            \
										AND subq2.user_in_role_id = subq1.user_in_role_id                                      \
										INNER JOIN subq3                                                                       \
										ON subq3.detection_variable_id = subq1.derived_detection_variable_id                   \
										AND subq3.user_in_role_id = subq1.user_in_role_id                                      \
										GROUP BY                                                                               \
											subq1.user_in_role_id,                                                             \
											subq1.derived_detection_variable_id,                                               \
											subq1.derivation_weight,                                                           \
											subq2.nui_zero_value,                                                              \
											subq2.nui_value,                                                                   \
											subq1.derived_nui_id,                                                              \
											subq3.derivation_weight                                                            \
									) SELECT                                                                                   \
										mainq.user_in_role_id AS uir_id,                                                       \
										mainq.derived_detection_variable_id AS ddv_id,                                         \
										mainq.derivation_weight AS weight,                                                     \
										SUM (                                                                                  \
											mainq.derived_mea_value * ABS (mainq.w1)                                           \
										) / SUM (ABS(mainq.w1)) AS ges_value                                                   \
									FROM                                                                                       \
										mainq                                                                                  \
									GROUP BY                                                                                   \
										mainq.user_in_role_id,                                                                 \
										mainq.derived_detection_variable_id,                                                   \
										mainq.derivation_weight                                                                \
									ORDER BY                                                                                   \
										mainq.user_in_role_id

ViewGefValuesPersistedSourceGesTypes.doAllGfvs = WITH subq1 AS (                                                               \
														SELECT                                                                 \
															user_in_role_id AS uir_id,                                         \
															derived_detection_variable_id AS ddv_id,                           \
															SUM (derivation_weight) AS sum_weight,                             \
															SUM (                                                              \
																gef_value * derivation_weight                                  \
															) AS sum_ges_value_weight                                          \
														FROM                                                                   \
															vw_gef_values_persisted_source_ges_types                           \
														WHERE                                                                  \
															interval_start >= :startOfMonth                                    \
														AND interval_start <= :endOfMonth                                      \
														AND typical_period = 'MON'                                             \
														AND derived_detection_variable_type = :detectionVariableType           \
														GROUP BY                                                               \
															(                                                                  \
																user_in_role_id,                                               \
																derived_detection_variable_id                                  \
															)                                                                  \
														ORDER BY                                                               \
															(user_in_role_id)                                                  \
													),                                                                         \
													 subq2 AS (                                                                \
														SELECT                                                                 \
															user_in_role_id AS uir_id,                                         \
															derivation_weight,                                                 \
															detection_variable_id AS dv_id                                     \
														FROM                                                                   \
															vw_gef_values_persisted_source_ges_types                           \
														WHERE                                                                  \
															interval_start >= :startOfMonth                                    \
														AND interval_start <= :endOfMonth                                      \
														AND typical_period = 'MON'                                             \
														AND detection_variable_type = :detectionVariableType                   \
													) SELECT                                                                   \
														subq1.uir_id,                                                          \
														subq1.ddv_id,                                                          \
														subq1.sum_ges_value_weight / subq1.sum_weight AS ges_value,            \
														subq2.derivation_weight AS weight                                      \
													FROM                                                                       \
														subq1                                                                  \
													LEFT JOIN subq2                                                            \
													ON subq1.uir_id = subq2.uir_id                                             \
													AND subq1.ddv_id = subq2.dv_id                                             \
													ORDER BY                                                                   \
														subq1.uir_id,                                                          \
														subq1.ddv_id